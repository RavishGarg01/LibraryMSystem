package services;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.client.RestTemplate;

import entites.RecipeEntity;
import repository.RecipeRepository;

import java.util.List;

@Service
public class RecipeService {
    private final RecipeRepository recipeRepository;
    private final RestTemplate restTemplate;

    private static final String RECIPE_URL = "https://dummyjson.com/recipes";

    public RecipeService(RecipeRepository recipeRepository, RestTemplate restTemplate) {
        this.recipeRepository = recipeRepository;
        this.restTemplate = restTemplate;
    }

    public void loadRecipesIntoDB() {
        RecipeEntity[] recipes = restTemplate.getForObject(RECIPE_URL, RecipeEntity[].class);
        if (recipes != null) {
            recipeRepository.saveAll(List.of(recipes));
        }
    }

    public List<RecipeEntity> findRecipesByFreeText(String query) {
        // Example logic for Hibernate Search (free-text)
    }

    public RecipeEntity getRecipeById(Long id) {
        return recipeRepository.findById(id)
                .orElseThrow(() -> new RecipeNotFoundException("Recipe not found for ID: " + id));
    }
}